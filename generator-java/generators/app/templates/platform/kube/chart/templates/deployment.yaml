apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: "{{tag '  .Chart.Name '}}-deployment"
  labels:
    chart: "{{tag ' .Chart.Name '}}-{{{tag ' .Chart.Version | replace "+" "_" '}}}"
spec:
  replicas:  {{tag ' .Values.replicaCount '}}
  revisionHistoryLimit: {{tag ' .Values.revisionHistoryLimit '}}
  template:
    metadata:
      labels:
        app: "{{tag '  .Chart.Name '}}-selector"
    spec:
     containers:
      - name: {{tag '  .Chart.Name  '}}
        image: "{{tag ' .Values.image.repository '}}{{tag ' .Values.image.name '}}:{{tag ' .Values.image.tag '}}"
        imagePullPolicy: {{tag ' .Values.image.pullPolicy '}}        
        readinessProbe:
          httpGet:
          {{! healthEndpoint is configured in the index.js and is different for basicweb}}
          {{#has frameworkType 'liberty'}}
            path: /{{appName}}/{{healthEndpoint}}
            port: 9080
          {{/has}}
          {{#has frameworkType 'spring'}}
            path: /{{healthEndpoint}}
            port: 8080
          {{/has}}
          initialDelaySeconds: 20
